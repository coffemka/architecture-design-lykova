<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #666;
            margin-top: 0;
        }
        .slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .slot-card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background: #fafafa;
        }
        .slot-card.free { border-left: 4px solid #4CAF50; }
        .slot-card.pending { border-left: 4px solid #FFC107; }
        .slot-card.booked { border-left: 4px solid #2196F3; }
        
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #666;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        button.secondary {
            background: #2196F3;
        }
        button.secondary:hover {
            background: #1976D2;
        }
        .result {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        pre {
            margin: 0;
            color: #333;
        }
        .error {
            color: #f44336;
            padding: 10px;
            background: #ffebee;
            border-radius: 4px;
        }
        .success {
            color: #4CAF50;
            padding: 10px;
            background: #E8F5E9;
            border-radius: 4px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #ddd;
            cursor: pointer;
            border-radius: 4px;
        }
        .tab.active {
            background: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('slots')">–°–ª–æ—Ç—ã</div>
            <div class="tab" onclick="showTab('bookings')">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>
            <div class="tab" onclick="showTab('create')">–°–æ–∑–¥–∞—Ç—å —Å–ª–æ—Ç</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Å–æ —Å–ª–æ—Ç–∞–º–∏ -->
        <div id="tab-slots" class="tab-content active">
            <div class="section">
                <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã</h2>
                <button onclick="loadSlots()" class="secondary">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                <div id="slots-list" style="margin-top: 20px;">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ -->
        <div id="tab-bookings" class="tab-content">
            <div class="section">
                <h2>–°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                <div class="form-group">
                    <label>ID —Å–ª–æ—Ç–∞:</label>
                    <input type="text" id="booking-slotId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID —Å–ª–æ—Ç–∞">
                </div>
                <div class="form-group">
                    <label>–í–∞—à–µ –∏–º—è:</label>
                    <input type="text" id="booking-studentName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
                </div>
                <div class="form-group">
                    <label>–¢–µ–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:</label>
                    <input type="text" id="booking-topic" placeholder="–û —á–µ–º —Ö–æ—Ç–∏—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="booking-email" placeholder="email@example.com">
                </div>
                <button onclick="createBooking()">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <div class="section">
                <h2>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                <div class="form-group">
                    <label>ID –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <input type="text" id="confirm-bookingId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è">
                </div>
                <button onclick="confirmBooking()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ—Ç–∞ -->
        <div id="tab-create" class="tab-content">
            <div class="section">
                <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–ª–æ—Ç (–¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è)</h2>
                <div class="form-group">
                    <label>ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</label>
                    <input type="text" id="slot-teacherId" value="teacher1">
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                    <input type="datetime-local" id="slot-startTime">
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                    <input type="datetime-local" id="slot-endTime">
                </div>
                <div class="form-group">
                    <label>–¢–∏–ø –≤—Å—Ç—Ä–µ—á–∏:</label>
                    <select id="slot-meetingType">
                        <option value="0">Online</option>
                        <option value="1">Offline</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="slot-description" rows="3"></textarea>
                </div>
                <button onclick="createSlot()">–°–æ–∑–¥–∞—Ç—å —Å–ª–æ—Ç</button>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ -->
        <div class="section">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
            <div class="result">
                <pre id="result">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ...</pre>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ—Ç–æ–≤
        async function loadSlots() {
            showResult('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ—Ç–æ–≤...');
            try {
                const response = await fetch(`${API_URL}/slots/available`);
                const data = await response.json();
                
                let html = '<div class="slots-grid">';
                if (data.slots && data.slots.length > 0) {
                    data.slots.forEach(slot => {
                        html += `
                            <div class="slot-card free">
                                <strong>${slot.teacherName}</strong><br>
                                üìÖ ${new Date(slot.startTime).toLocaleString()}<br>
                                ‚è±Ô∏è ${new Date(slot.endTime).toLocaleTimeString()}<br>
                                ${slot.meetingType === 0 ? 'üíª Online' : 'üè¢ Offline'}<br>
                                üìù ${slot.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}<br>
                                <small>ID: ${slot.id}</small>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤</p>';
                }
                html += '</div>';
                
                document.getElementById('slots-list').innerHTML = html;
                showResult(JSON.stringify(data, null, 2));
            } catch (error) {
                document.getElementById('slots-list').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
                showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        async function createBooking() {
            const bookingData = {
                slotId: document.getElementById('booking-slotId').value,
                studentId: 'student_' + Date.now(),
                studentName: document.getElementById('booking-studentName').value,
                topic: document.getElementById('booking-topic').value,
                contactInfo: {
                    email: document.getElementById('booking-email').value
                }
            };

            if (!bookingData.slotId || !bookingData.studentName || !bookingData.topic) {
                showResult('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', true);
                return;
            }

            showResult('–°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...');
            
            try {
                const response = await fetch(`${API_URL}/bookings`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bookingData)
                });
                const data = await response.json();
                showResult(JSON.stringify(data, null, 2));
                loadSlots(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ—Ç–æ–≤
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        async function confirmBooking() {
            const bookingId = document.getElementById('confirm-bookingId').value;
            
            if (!bookingId) {
                showResult('–í–≤–µ–¥–∏—Ç–µ ID –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!', true);
                return;
            }

            showResult('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...');
            
            try {
                const response = await fetch(`${API_URL}/bookings/${bookingId}/confirm`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        teacherNotes: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å',
                        sendNotification: true
                    })
                });
                const data = await response.json();
                showResult(JSON.stringify(data, null, 2));
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–∞
        async function createSlot() {
            const startTime = new Date(document.getElementById('slot-startTime').value);
            const endTime = new Date(document.getElementById('slot-endTime').value);
            
            const slotData = {
                teacherId: document.getElementById('slot-teacherId').value,
                startTime: startTime.toISOString(),
                endTime: endTime.toISOString(),
                meetingType: parseInt(document.getElementById('slot-meetingType').value),
                description: document.getElementById('slot-description').value
            };

            if (!slotData.startTime || !slotData.endTime) {
                showResult('–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è!', true);
                return;
            }

            showResult('–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–∞...');
            
            try {
                const response = await fetch(`${API_URL}/slots`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(slotData)
                });
                const data = await response.json();
                showResult(JSON.stringify(data, null, 2));
                loadSlots(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ—Ç–æ–≤
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult(message, isError = false) {
            const resultEl = document.getElementById('result');
            resultEl.textContent = typeof message === 'string' ? message : JSON.stringify(message, null, 2);
            resultEl.style.color = isError ? '#f44336' : '#333';
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–æ—Ç—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadSlots();
    </script>
</body>
</html>